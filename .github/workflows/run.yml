name: Run Bot

on:
  workflow_dispatch: {}               # əl ilə Run düyməsi
  schedule:
    - cron: "0 9,14,20 * * *"         # gündə 3 dəfə (UTC)

jobs:
  run:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v3

      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: "3.10"

      - name: Install deps
        run: |
          python -m pip install --upgrade pip
          pip install feedparser requests gspread google-auth google-auth-oauthlib google-auth-httplib2

      # (opsional) Secrets-diagnoz – ilk dəfə işə salanda rahat debuq üçündür
      - name: Check TELEGRAM_BOT_TOKEN
        run: |
          test -n "$TELEGRAM_BOT_TOKEN" && echo "Token set" || (echo "Token MISSING"; exit 1)
        env:
          TELEGRAM_BOT_TOKEN: ${{ secrets.TELEGRAM_BOT_TOKEN }}

      - name: Run script
        env:
          TELEGRAM_BOT_TOKEN: ${{ secrets.TELEGRAM_BOT_TOKEN }}
          TELEGRAM_CHAT_ID:   ${{ secrets.TELEGRAM_CHAT_ID }}
          KEYWORDS:           ${{ secrets.KEYWORDS }}           # misal: ayaqqabı/paltar/phone
          ACTIVE_PLATFORMS:   ${{ secrets.ACTIVE_PLATFORMS }}   # misal: reddit,youtube,hackernews,producthunt,instagram,tiktok,threads
          DAILY_LIMIT:        ${{ secrets.DAILY_LIMIT }}        # misal: 200
          RSSHUB_BASE:        ${{ secrets.RSSHUB_BASE }}        # misal: https://rsshub.app (opsional)
          SHEETS_JSON:        ${{ secrets.SHEETS_JSON }}        # service account JSON (opsional)
          SHEETS_SPREADSHEET_ID: ${{ secrets.SHEETS_SPREADSHEET_ID }}  # opsional
          SHEETS_WORKSHEET:   ${{ secrets.SHEETS_WORKSHEET }}   # misal: Sheet1 (opsional)
        run: python .github/workflows/main.py
